var getParams=function(e,t){var a,r,s=[];for(r in e)s.push(r+"="+encodeURIComponent(e[r]));return""!=(a=s.join("&"))?t?t.indexOf("?")<0?"?"+a:"&"+a:a:""},handleProcess=function(t){var a=this;return this.xhr=null,window.ActiveXObject?this.xhr=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){var e;4==a.xhr.readyState&&200==a.xhr.status?(e=a.xhr.responseText,!0===t.json&&"undefined"!=typeof JSON&&(e=JSON.parse(e)),a.doneCallback&&a.doneCallback.apply(a.host,[e,a.xhr])):4==a.xhr.readyState&&a.failCallback&&a.failCallback.apply(a.host,[a.xhr]),a.alwaysCallback&&a.alwaysCallback.apply(a.host,[a.xhr])}),"get"==t.method?this.xhr.open("GET",t.url+getParams(t.data,t.url),!0):(this.xhr.open(t.method,t.url,!0),this.setHeaders({"X-Requested-With":"XMLHttpRequest","Content-type":"application/x-www-form-urlencoded"})),t.headers&&"object"==typeof t.headers&&this.setHeaders(t.headers),setTimeout(function(){"get"==t.method?a.xhr.send():a.xhr.send(getParams(t.data))},20),this},handleSetHeaders=function(e){for(var t in e)this.xhr&&this.xhr.setRequestHeader(t,e[t])};module.exports={request:function(e){return(e="string"==typeof e?{url:e}:e).url=e.url||"",e.method=e.method||"get",e.data=e.data||{},{host:{},process:function(e){return handleProcess.call(this,e)},done:function(e){return this.doneCallback=e,this},fail:function(e){return this.failCallback=e,this},always:function(e){return this.alwaysCallback=e,this},setHeaders:function(e){handleSetHeaders.call(this,e)}}.process(e)}};